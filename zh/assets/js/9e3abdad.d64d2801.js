(window.webpackJsonp=window.webpackJsonp||[]).push([[168],{241:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return a})),t.d(n,"metadata",(function(){return p})),t.d(n,"toc",(function(){return c})),t.d(n,"default",(function(){return s}));var i=t(3),o=t(7),r=(t(0),t(342)),a={title:"Specify Definition Revision in Application"},p={unversionedId:"end-user/definition-revision",id:"end-user/definition-revision",isDocsHomePage:!1,title:"Specify Definition Revision in Application",description:"Each time the platform provider update ComponentDefinition/TraitDefinition, a corresponding DefinitionRevision will be generated.",source:"@site/docs/end-user/definition-revision.md",slug:"/end-user/definition-revision",permalink:"/zh/docs/next/end-user/definition-revision",editUrl:"https://github.com/oam-dev/kubevela/edit/master/docs/zh/end-user/definition-revision.md",version:"current",lastUpdatedBy:"kubevela-bot",lastUpdatedAt:1620381187,formattedLastUpdatedAt:"5/7/2021",sidebar:"docs",previous:{title:"Want More?",permalink:"/zh/docs/next/end-user/traits/more"},next:{title:"\u591a\u96c6\u7fa4\u5e94\u7528\u90e8\u7f72",permalink:"/zh/docs/next/end-user/scopes/appdeploy"}},c=[{value:"Usage of Definition",id:"usage-of-definition",children:[]},{value:"Specify Definition Version in Application",id:"specify-definition-version-in-application",children:[]}],l={toc:c};function s(e){var n=e.components,t=Object(o.a)(e,["components"]);return Object(r.b)("wrapper",Object(i.a)({},l,t,{components:n,mdxType:"MDXLayout"}),Object(r.b)("p",null,"Each time the platform provider update ComponentDefinition/TraitDefinition, a corresponding DefinitionRevision will be generated.\nAnd the DefinitionRevision can be regarded as a snapshot of ComponentDefinition/TraitDefinition."),Object(r.b)("p",null,"In this section, we will introduce how to specify a revision in Application."),Object(r.b)("h2",{id:"usage-of-definition"},"Usage of Definition"),Object(r.b)("p",null,"Suppose we need a ",Object(r.b)("inlineCode",{parentName:"p"},"worker")," to run a background service. And the platform provider has already provided a ",Object(r.b)("inlineCode",{parentName:"p"},"worker"),"\nComponentDefinition for us(The ComponentDefinition ",Object(r.b)("inlineCode",{parentName:"p"},"worker")," may have been updated multiple times)."),Object(r.b)("p",null,"Assume the platform provider registered the ",Object(r.b)("inlineCode",{parentName:"p"},"v1")," version of the ",Object(r.b)("inlineCode",{parentName:"p"},"worker")," like below:"),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Click to see how to register the v1 version of the worker")),Object(r.b)("details",null,Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-shell"},"kubectl apply -f https://raw.githubusercontent.com/oam-dev/kubevela/master/docs/examples/definition-revision/worker-v1.yaml\n"))),Object(r.b)("p",null,"We can use ",Object(r.b)("inlineCode",{parentName:"p"},"kubectl vela show")," to see the specification doc of the ",Object(r.b)("inlineCode",{parentName:"p"},"worker"),"."),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-shell"},"$ kubectl vela show worker\n# Properties\n+-------+----------------------------------------------------+----------+----------+---------+\n| NAME  |                    DESCRIPTION                     |   TYPE   | REQUIRED | DEFAULT |\n+-------+----------------------------------------------------+----------+----------+---------+\n| cmd   | Commands to run in the container                   | []string | false    |         |\n| image | Which image would you like to use for your service | string   | true     |         |\n+-------+----------------------------------------------------+----------+----------+---------+\n")),Object(r.b)("p",null,"Assume the platform provider has updated the version of the ",Object(r.b)("inlineCode",{parentName:"p"},"worker")," to ",Object(r.b)("inlineCode",{parentName:"p"},"v2")," like below."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Click to see how to update")),Object(r.b)("details",null,Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-shell"},"kubectl apply -f https://raw.githubusercontent.com/oam-dev/kubevela/master/docs/examples/definition-revision/worker-v2.yaml\n"))),Object(r.b)("p",null,"The latest worker ComponentDefinition adds the ",Object(r.b)("inlineCode",{parentName:"p"},"port")," parameter, allowing users to specify the port exposed by the container."),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-shell"},"$ kubectl vela show worker\n# Properties\n+-------+----------------------------------------------------+----------+----------+---------+\n| NAME  |                    DESCRIPTION                     |   TYPE   | REQUIRED | DEFAULT |\n+-------+----------------------------------------------------+----------+----------+---------+\n| cmd   | Commands to run in the container                   | []string | false    |         |\n| image | Which image would you like to use for your service | string   | true     |         |\n| port  | Which port do you want customer traffic sent to    | int      | true     |         |\n+-------+----------------------------------------------------+----------+----------+---------+\n")),Object(r.b)("p",null,"When the platform provider updated the two versions of the worker, the corresponding DefinitionRevision will\nbe generated to store the snapshot information."),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-shell"},'$ kubectl get definitionrevision -l="componentdefinition.oam.dev/name=worker"\nNAME        REVISION   HASH               TYPE\nworker-v1   1          76486234845427dc   Component\nworker-v2   2          cb22fdc3b037702e   Component\n')),Object(r.b)("h2",{id:"specify-definition-version-in-application"},"Specify Definition Version in Application"),Object(r.b)("p",null,"We can specify the Component to use a specific version of the Definition in Application,\nBy default, the application will always use the latest Definition to render the Component."),Object(r.b)("p",null,"But the latest Definition may not be compatible with user's application, so we can specify the old version like ",Object(r.b)("inlineCode",{parentName:"p"},"v1")," of the worker to render the Component.\nwe can specify the version of Definition in format ",Object(r.b)("inlineCode",{parentName:"p"},"definitionName@version"),"."),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-yaml"},"# testapp.yaml\napiVersion: core.oam.dev/v1beta1\nkind: Application\nmetadata:\n  name: testapp\nspec:\n  components:\n    - name: backend\n      type: worker@v1\n      properties:\n        image: crccheck/hello-world\n")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-shell"},"kubectl apply -f testapp.yaml\n")),Object(r.b)("p",null,"The ",Object(r.b)("inlineCode",{parentName:"p"},"v1")," version of the ",Object(r.b)("inlineCode",{parentName:"p"},"worker")," only allows the container to expose port ",Object(r.b)("inlineCode",{parentName:"p"},"8000"),"."),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-shell"},'$ kubectl get deployment\nNAME      READY   UP-TO-DATE   AVAILABLE   AGE\nbackend   1/1     1            1           3m7s\n\n$ kubectl get deployment backend -o jsonpath="{.spec.template.spec.containers[0].ports[0].containerPort}"\n8000\n')))}s.isMDXComponent=!0},342:function(e,n,t){"use strict";t.d(n,"a",(function(){return d})),t.d(n,"b",(function(){return m}));var i=t(0),o=t.n(i);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function p(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function c(e,n){if(null==e)return{};var t,i,o=function(e,n){if(null==e)return{};var t,i,o={},r=Object.keys(e);for(i=0;i<r.length;i++)t=r[i],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)t=r[i],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var l=o.a.createContext({}),s=function(e){var n=o.a.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):p(p({},n),e)),t},d=function(e){var n=s(e.components);return o.a.createElement(l.Provider,{value:n},e.children)},b={inlineCode:"code",wrapper:function(e){var n=e.children;return o.a.createElement(o.a.Fragment,{},n)}},u=o.a.forwardRef((function(e,n){var t=e.components,i=e.mdxType,r=e.originalType,a=e.parentName,l=c(e,["components","mdxType","originalType","parentName"]),d=s(t),u=i,m=d["".concat(a,".").concat(u)]||d[u]||b[u]||r;return t?o.a.createElement(m,p(p({ref:n},l),{},{components:t})):o.a.createElement(m,p({ref:n},l))}));function m(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var r=t.length,a=new Array(r);a[0]=u;var p={};for(var c in n)hasOwnProperty.call(n,c)&&(p[c]=n[c]);p.originalType=e,p.mdxType="string"==typeof e?e:i,a[1]=p;for(var l=2;l<r;l++)a[l]=t[l];return o.a.createElement.apply(null,a)}return o.a.createElement.apply(null,t)}u.displayName="MDXCreateElement"}}]);